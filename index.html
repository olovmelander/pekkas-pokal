<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pekkas Pokal - √Örlig T√§vling</title>
    
    <style>
        :root {
          --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
          --danger-gradient: linear-gradient(135deg, #ff4757 0%, #c44569 100%);
          
          --primary-color: #667eea;
          --success-color: #4CAF50;
          --danger-color: #ff4757;
          
          --bg-primary: #ffffff;
          --bg-secondary: #f8fafc;
          --bg-tertiary: #e2e8f0;
          --text-primary: #1a202c;
          --text-secondary: #4a5568;
          --text-muted: #718096;
          --border-color: #e2e8f0;
          --shadow-light: 0 1px 3px rgba(0,0,0,0.1);
          --shadow-medium: 0 4px 6px rgba(0,0,0,0.1);
          --shadow-heavy: 0 10px 15px rgba(0,0,0,0.1);
          
          --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
          --font-size-xs: 0.75rem;
          --font-size-sm: 0.875rem;
          --font-size-base: 1rem;
          --font-size-lg: 1.125rem;
          --font-size-xl: 1.25rem;
          --font-size-2xl: 1.5rem;
          --font-size-3xl: 1.875rem;
          --font-size-4xl: 2.25rem;
          
          --spacing-xs: 0.25rem;
          --spacing-sm: 0.5rem;
          --spacing-md: 1rem;
          --spacing-lg: 1.5rem;
          --spacing-xl: 2rem;
          --spacing-2xl: 3rem;
          
          --radius-sm: 0.25rem;
          --radius-md: 0.5rem;
          --radius-lg: 0.75rem;
          --radius-xl: 1rem;
          --radius-2xl: 1.5rem;
          
          --transition-fast: 150ms ease;
          --transition-normal: 250ms ease;
          --transition-slow: 350ms ease;
        }

        [data-theme="dark"] {
          --bg-primary: #1a202c;
          --bg-secondary: #2d3748;
          --bg-tertiary: #4a5568;
          --text-primary: #f7fafc;
          --text-secondary: #e2e8f0;
          --text-muted: #a0aec0;
          --border-color: #4a5568;
        }

        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        body {
          font-family: var(--font-family);
          font-size: var(--font-size-base);
          line-height: 1.6;
          color: var(--text-primary);
          background: var(--bg-secondary);
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

        .app {
          min-height: 100vh;
          display: flex;
          flex-direction: column;
        }

        .header {
          background: var(--bg-primary);
          box-shadow: var(--shadow-light);
          border-bottom: 1px solid var(--border-color);
        }

        .header-content {
          max-width: 1200px;
          margin: 0 auto;
          padding: var(--spacing-lg) var(--spacing-xl);
          display: flex;
          align-items: center;
          justify-content: space-between;
        }

        .logo-section {
          display: flex;
          align-items: center;
          gap: var(--spacing-lg);
        }

        .trophy-icon {
          font-size: 3rem;
          animation: pulse 2s infinite;
        }

        @keyframes pulse {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.05); }
        }

        .title-section h1 {
          font-size: var(--font-size-3xl);
          font-weight: 800;
          background: var(--primary-gradient);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          margin-bottom: var(--spacing-xs);
        }

        .subtitle {
          color: var(--text-secondary);
          font-weight: 500;
        }

        .header-actions {
          display: flex;
          align-items: center;
          gap: var(--spacing-md);
        }

        .icon-btn {
          width: 44px;
          height: 44px;
          border: none;
          border-radius: var(--radius-lg);
          background: var(--bg-secondary);
          color: var(--text-primary);
          font-size: var(--font-size-lg);
          cursor: pointer;
          transition: all var(--transition-fast);
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .icon-btn:hover {
          background: var(--bg-tertiary);
          transform: translateY(-2px);
        }

        .navigation {
          background: var(--bg-primary);
          border-bottom: 1px solid var(--border-color);
        }

        .nav-container {
          max-width: 1200px;
          margin: 0 auto;
          display: flex;
          padding: 0 var(--spacing-xl);
        }

        .nav-tab {
          flex: 1;
          padding: var(--spacing-lg) var(--spacing-md);
          border: none;
          background: transparent;
          color: var(--text-secondary);
          cursor: pointer;
          transition: all var(--transition-fast);
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--spacing-xs);
          position: relative;
          overflow: hidden;
        }

        .nav-tab::before {
          content: '';
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          height: 3px;
          background: var(--primary-gradient);
          transform: translateX(-100%);
          transition: transform var(--transition-normal);
        }

        .nav-tab.active::before {
          transform: translateX(0);
        }

        .nav-tab.active {
          color: var(--primary-color);
          background: rgba(102, 126, 234, 0.05);
        }

        .nav-tab:hover:not(.active) {
          background: var(--bg-secondary);
          color: var(--text-primary);
        }

        .nav-icon {
          font-size: var(--font-size-lg);
        }

        .nav-text {
          font-size: var(--font-size-sm);
          font-weight: 600;
        }

        .main-content {
          flex: 1;
          max-width: 1200px;
          margin: 0 auto;
          width: 100%;
          padding: var(--spacing-xl);
        }

        .tab-content {
          display: none;
          animation: fadeInUp var(--transition-normal) ease-out;
        }

        .tab-content.active {
          display: block;
        }

        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .content-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: var(--spacing-2xl);
          flex-wrap: wrap;
          gap: var(--spacing-lg);
        }

        .content-header h2 {
          font-size: var(--font-size-2xl);
          font-weight: 700;
          color: var(--text-primary);
        }

        .btn {
          display: inline-flex;
          align-items: center;
          gap: var(--spacing-sm);
          padding: var(--spacing-md) var(--spacing-lg);
          border: none;
          border-radius: var(--radius-lg);
          font-weight: 600;
          font-size: var(--font-size-sm);
          cursor: pointer;
          transition: all var(--transition-fast);
          text-decoration: none;
          position: relative;
          overflow: hidden;
        }

        .btn.primary {
          background: var(--primary-gradient);
          color: white;
        }

        .btn.primary:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-medium);
        }

        .btn.success {
          background: var(--success-gradient);
          color: white;
        }

        .btn.success:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-medium);
        }

        .btn.danger {
          background: var(--danger-gradient);
          color: white;
        }

        .btn.danger:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-medium);
        }

        .btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
          transform: none !important;
        }

        .csv-import-section {
          background: var(--bg-primary);
          padding: var(--spacing-xl);
          border-radius: var(--radius-xl);
          box-shadow: var(--shadow-light);
          border: 1px solid var(--border-color);
          margin-bottom: var(--spacing-2xl);
          text-align: center;
        }

        .csv-import-section.hidden {
          display: none;
        }

        .csv-import-section h3 {
          color: var(--primary-color);
          margin-bottom: var(--spacing-lg);
          font-size: var(--font-size-xl);
        }

        .csv-import-section p {
          color: var(--text-secondary);
          margin-bottom: var(--spacing-lg);
        }

        .import-status {
          padding: var(--spacing-md);
          border-radius: var(--radius-lg);
          margin: var(--spacing-lg) 0;
          font-weight: 600;
        }

        .import-status.success {
          background: rgba(76, 175, 80, 0.1);
          color: var(--success-color);
        }

        .import-status.error {
          background: rgba(255, 71, 87, 0.1);
          color: var(--danger-color);
        }

        .import-status.info {
          background: rgba(102, 126, 234, 0.1);
          color: var(--primary-color);
        }

        .hidden {
          display: none !important;
        }

        .text-center {
          text-align: center;
        }

        @media (max-width: 768px) {
          .header-content {
            flex-direction: column;
            gap: var(--spacing-lg);
            text-align: center;
          }
          
          .nav-text {
            display: none;
          }
          
          .title-section h1 {
            font-size: var(--font-size-xl);
          }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <span class="trophy-icon">üèÜ</span>
                    <div class="title-section">
                        <h1>Pekkas Pokal</h1>
                        <p class="subtitle">√Örlig T√§vling ‚Ä¢ <span id="year-range">2011-2024</span></p>
                    </div>
                </div>
                
                <div class="header-actions">
                    <button id="theme-toggle" class="icon-btn" title="V√§xla tema">üåô</button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="navigation">
            <div class="nav-container">
                <button class="nav-tab active" data-tab="results">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Resultat</span>
                </button>
                <button class="nav-tab" data-tab="statistics">
                    <span class="nav-icon">üìà</span>
                    <span class="nav-text">Statistik</span>
                </button>
                <button class="nav-tab" data-tab="participants">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Deltagare</span>
                </button>
                <button class="nav-tab" data-tab="settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Inst√§llningar</span>
                </button>
            </div>
        </nav>

        <!-- CSV Import Section -->
        <div id="csv-import-section" class="csv-import-section">
            <h3>üèÜ V√§lkommen till Pekkas Pokal!</h3>
            <p>Importera dina t√§vlingsdata f√∂r att komma ig√•ng</p>
            <div id="import-status" class="import-status info">
                V√§lj din CSV-fil f√∂r att importera t√§vlingsdata
            </div>
            <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
            <button id="import-csv-btn" class="btn success">
                üìä Importera T√§vlingsdata
            </button>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Results Tab -->
            <section id="results-tab" class="tab-content active">
                <div class="content-header">
                    <h2>T√§vlingsresultat per √Ör</h2>
                </div>
                
                <div id="results-content">
                    <div class="text-center">
                        <p>Importera CSV-data f√∂r att visa t√§vlingsresultat</p>
                    </div>
                </div>
            </section>

            <!-- Statistics Tab -->
            <section id="statistics-tab" class="tab-content">
                <div class="content-header">
                    <h2>Statistik</h2>
                </div>
                <div id="statistics-content">
                    <div class="text-center">
                        <p>Statistik visas efter import av t√§vlingsdata</p>
                    </div>
                </div>
            </section>

            <!-- Participants Tab -->
            <section id="participants-tab" class="tab-content">
                <div class="content-header">
                    <h2>Deltagare</h2>
                </div>
                <div id="participants-content">
                    <div class="text-center">
                        <p>Deltagare visas efter import av t√§vlingsdata</p>
                    </div>
                </div>
            </section>

            <!-- Settings Tab -->
            <section id="settings-tab" class="tab-content">
                <div class="content-header">
                    <h2>Inst√§llningar</h2>
                </div>
                <div id="settings-content">
                    <div class="text-center">
                        <p>Inst√§llningar blir tillg√§ngliga efter import</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // PEKKAS POKAL - 100% EGEN IMPLEMENTATION UTAN EXTERNA BIBLIOTEK
        console.log('üöÄ Pekkas Pokal startar...');

        class CSVImporter {
            constructor() {
                this.competitions = [];
                this.participants = [];
            }

            // L√ÑS OCH TOLKA CSV FIL
            async importFile(file) {
                console.log('üìÅ L√§ser fil:', file.name);
                
                // L√§s filinneh√•ll
                const content = await this.readFile(file);
                console.log('üìñ Fil l√§st, storlek:', content.length, 'tecken');
                
                // Tolka CSV
                const data = this.parseCSV(content);
                console.log('üìä CSV data:', data);
                
                // Konvertera till app-format
                this.convertData(data);
                
                return {
                    competitions: this.competitions,
                    participants: this.participants
                };
            }

            // L√ÑS FIL MED FILEREADER
            readFile(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.onerror = e => reject(new Error('Kunde inte l√§sa filen'));
                    reader.readAsText(file, 'UTF-8');
                });
            }

            // TOLKA CSV (enkel men robust parser)
            parseCSV(text) {
                const lines = text.trim().split('\n');
                if (lines.length < 2) {
                    throw new Error('CSV-filen m√•ste ha minst 2 rader');
                }

                // F√∂rsta raden = headers
                const headers = this.parseLine(lines[0]);
                console.log('üìã Kolumner:', headers);

                // Resterande rader = data
                const rows = [];
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) { // Hoppa √∂ver tomma rader
                        const values = this.parseLine(line);
                        const row = {};
                        
                        // Mappa v√§rden till kolumnnamn
                        headers.forEach((header, index) => {
                            row[header] = values[index] || '';
                        });
                        
                        rows.push(row);
                    }
                }

                return { headers, rows };
            }

            // TOLKA EN CSV-RAD
            parseLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;

                for (let i = 0; i < line.length; i++) {
                    const char = line[i];

                    if (char === '"') {
                        if (inQuotes && line[i + 1] === '"') {
                            // Dubbla citattecken = escaped quote
                            current += '"';
                            i++; // Hoppa √∂ver n√§sta quote
                        } else {
                            // V√§xla quote-l√§ge
                            inQuotes = !inQuotes;
                        }
                    } else if (char === ',' && !inQuotes) {
                        // Komma = ny kolumn
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }

                // L√§gg till sista kolumnen
                result.push(current.trim());
                return result;
            }

            // KONVERTERA CSV DATA TILL APP-FORMAT
            convertData(data) {
                console.log('üîÑ Konverterar data...');

                // F√• deltagarna fr√•n kolumnnamnen (hoppa √∂ver √Ör, T√§vling, Plats)
                const participantNames = data.headers.slice(3);
                console.log('üë• Deltagare:', participantNames);

                // Skapa deltagare
                this.participants = participantNames.map(name => ({
                    id: this.generateId('participant'),
                    name: name.trim(),
                    nickname: this.createNickname(name.trim()),
                    status: 'active',
                    createdAt: new Date().toISOString()
                }));

                // Skapa mappning fr√•n namn till ID
                const nameToId = {};
                this.participants.forEach(p => {
                    nameToId[p.name] = p.id;
                });

                // Skapa t√§vlingar
                this.competitions = [];
                data.rows.forEach(row => {
                    const year = parseInt(row['√Ör']);
                    const name = row['T√§vling']?.trim();
                    const location = row['Plats']?.trim() || '';

                    if (!year || !name) {
                        console.warn('‚ö†Ô∏è Hoppar √∂ver ogiltig rad:', row);
                        return;
                    }

                    // Samla po√§ng f√∂r deltagarna
                    const scores = {};
                    let winner = null;
                    let bestPosition = Infinity;

                    participantNames.forEach(participantName => {
                        const scoreText = row[participantName]?.toString()?.trim();
                        if (scoreText && scoreText !== '' && scoreText !== '-') {
                            const position = this.parsePosition(scoreText);
                            if (position !== null) {
                                const participantId = nameToId[participantName];
                                scores[participantId] = position;

                                // Best√§m vinnare (l√§gsta position = b√§st)
                                if (position < bestPosition) {
                                    bestPosition = position;
                                    winner = participantName;
                                }
                            }
                        }
                    });

                    this.competitions.push({
                        id: this.generateId('competition'),
                        year: year,
                        name: name,
                        location: location,
                        winner: winner,
                        scores: scores,
                        createdAt: new Date().toISOString()
                    });
                });

                // Sortera t√§vlingar efter √•r (nyast f√∂rst)
                this.competitions.sort((a, b) => b.year - a.year);

                console.log('‚úÖ Konvertering klar:', {
                    competitions: this.competitions.length,
                    participants: this.participants.length
                });
            }

            // TOLKA POSITION (nummer eller text)
            parsePosition(value) {
                if (!value || value === '-') return null;

                // F√∂rs√∂k nummer f√∂rst
                const num = parseInt(value);
                if (!isNaN(num) && num > 0) {
                    return num;
                }

                // Hantera svensk text
                const text = value.toLowerCase().trim();
                if (text.includes('n√§st sist')) return 99;
                if (text === 'sist') return 100;

                return null;
            }

            // SKAPA SMEKNAMN
            createNickname(fullName) {
                const parts = fullName.split(' ');
                if (parts.length >= 2) {
                    return `${parts[0]} ${parts[parts.length - 1].charAt(0)}.`;
                }
                return fullName;
            }

            // GENERERA UNIKT ID
            generateId(prefix = 'id') {
                return `${prefix}_${Math.random().toString(36).substr(2, 9)}_${Date.now().toString(36)}`;
            }
        }

        class PekkasPokalkApp {
            constructor() {
                this.importer = new CSVImporter();
                this.competitions = [];
                this.participants = [];
                this.currentTab = 'results';
                
                this.init();
            }

            init() {
                console.log('üèÜ Initierar app...');
                this.setupEventListeners();
                
                // Kolla om data redan finns
                if (this.loadExistingData()) {
                    this.hideImportSection();
                    this.renderAllTabs();
                } else {
                    this.showImportSection();
                }
            }

            setupEventListeners() {
                // CSV Import
                document.getElementById('import-csv-btn').addEventListener('click', () => {
                    document.getElementById('csv-file-input').click();
                });

                document.getElementById('csv-file-input').addEventListener('change', (e) => {
                    if (e.target.files[0]) {
                        this.handleFileImport(e.target.files[0]);
                    }
                });

                // Navigation
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const targetTab = e.target.closest('.nav-tab').dataset.tab;
                        this.switchTab(targetTab);
                    });
                });

                // Theme toggle
                document.getElementById('theme-toggle').addEventListener('click', () => {
                    this.toggleTheme();
                });
            }

            async handleFileImport(file) {
                const statusEl = document.getElementById('import-status');
                const btnEl = document.getElementById('import-csv-btn');

                try {
                    statusEl.textContent = 'L√§ser och bearbetar fil...';
                    statusEl.className = 'import-status info';
                    btnEl.textContent = '‚è≥ Bearbetar...';
                    btnEl.disabled = true;

                    // Importera med egen CSV-parser
                    const data = await this.importer.importFile(file);
                    
                    this.competitions = data.competitions;
                    this.participants = data.participants;

                    // Spara data
                    this.saveData();

                    // Rendera alla flikar
                    this.renderAllTabs();

                    statusEl.textContent = `‚úÖ Import klar! ${this.competitions.length} t√§vlingar och ${this.participants.length} deltagare importerade.`;
                    statusEl.className = 'import-status success';

                    // G√∂m import-sektion efter 3 sekunder
                    setTimeout(() => {
                        this.hideImportSection();
                        btnEl.textContent = 'üìä Importera T√§vlingsdata';
                        btnEl.disabled = false;
                    }, 3000);

                } catch (error) {
                    console.error('‚ùå Import fel:', error);
                    statusEl.textContent = `‚ùå Import misslyckades: ${error.message}`;
                    statusEl.className = 'import-status error';
                    btnEl.textContent = 'üìä Importera T√§vlingsdata';
                    btnEl.disabled = false;
                }
            }

            saveData() {
                const data = {
                    version: '2.0',
                    timestamp: new Date().toISOString(),
                    competitions: this.competitions,
                    participants: this.participants
                };
                localStorage.setItem('pekkas-pokal-data', JSON.stringify(data));
                console.log('üíæ Data sparad');
            }

            loadExistingData() {
                try {
                    const stored = localStorage.getItem('pekkas-pokal-data');
                    if (stored) {
                        const data = JSON.parse(stored);
                        this.competitions = data.competitions || [];
                        this.participants = data.participants || [];
                        console.log('üìÇ Befintlig data laddad');
                        return true;
                    }
                } catch (error) {
                    console.error('‚ùå Fel vid laddning:', error);
                }
                return false;
            }

            renderAllTabs() {
                this.renderResults();
                this.renderParticipants();
                this.renderStatistics();
                this.renderSettings();
            }

            renderResults() {
                const content = document.getElementById('results-content');
                
                if (this.competitions.length === 0) {
                    content.innerHTML = '<div class="text-center"><p>Inga t√§vlingar att visa √§nnu.</p></div>';
                    return;
                }

                let html = `
                    <div style="background: var(--bg-primary); padding: var(--spacing-xl); border-radius: var(--radius-xl); box-shadow: var(--shadow-light); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary-color);">Alla T√§vlingar (${this.competitions.length})</h3>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; min-width: 600px;">
                                <thead>
                                    <tr style="background: var(--primary-gradient); color: white;">
                                        <th style="padding: var(--spacing-md); text-align: left; white-space: nowrap;">√Ör</th>
                                        <th style="padding: var(--spacing-md); text-align: left;">T√§vling</th>
                                        <th style="padding: var(--spacing-md); text-align: left;">Plats</th>
                                        <th style="padding: var(--spacing-md); text-align: left;">Vinnare</th>
                                        <th style="padding: var(--spacing-md); text-align: left; white-space: nowrap;">Deltagare</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                this.competitions.forEach(comp => {
                    const participantCount = Object.keys(comp.scores || {}).length;
                    html += `
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: var(--spacing-md); font-weight: 700; color: var(--primary-color);">${comp.year}</td>
                            <td style="padding: var(--spacing-md);">${comp.name}</td>
                            <td style="padding: var(--spacing-md); color: var(--text-secondary);">${comp.location || '-'}</td>
                            <td style="padding: var(--spacing-md); font-weight: 600; color: var(--success-color);">${comp.winner || 'TBD'}</td>
                            <td style="padding: var(--spacing-md);">${participantCount}</td>
                        </tr>
                    `;
                });

                html += '</tbody></table></div></div>';
                content.innerHTML = html;
            }

            renderParticipants() {
                const content = document.getElementById('participants-content');
                
                if (this.participants.length === 0) {
                    content.innerHTML = '<div class="text-center"><p>Inga deltagare att visa √§nnu.</p></div>';
                    return;
                }

                let html = `
                    <div style="background: var(--bg-primary); padding: var(--spacing-xl); border-radius: var(--radius-xl); box-shadow: var(--shadow-light); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary-color);">Alla Deltagare (${this.participants.length})</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: var(--spacing-lg);">
                `;

                this.participants.forEach(participant => {
                    const participantCompetitions = this.competitions.filter(comp => 
                        comp.scores && comp.scores[participant.id] !== undefined
                    );
                    const wins = this.competitions.filter(comp => comp.winner === participant.name).length;

                    html += `
                        <div style="background: var(--bg-secondary); padding: var(--spacing-lg); border-radius: var(--radius-lg); border: 1px solid var(--border-color); transition: transform 0.2s ease;">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-sm); font-size: var(--font-size-lg);">${participant.name}</h4>
                            <p style="color: var(--text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-md);">${participant.nickname}</p>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                                <div style="text-align: center;">
                                    <div style="font-weight: 700; font-size: var(--font-size-xl); color: var(--primary-color);">${participantCompetitions.length}</div>
                                    <div style="font-size: var(--font-size-xs); color: var(--text-muted); text-transform: uppercase;">T√§vlingar</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-weight: 700; font-size: var(--font-size-xl); color: var(--success-color);">${wins}</div>
                                    <div style="font-size: var(--font-size-xs); color: var(--text-muted); text-transform: uppercase;">Vinster</div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div></div>';
                content.innerHTML = html;
            }

            renderStatistics() {
                const content = document.getElementById('statistics-content');
                
                if (this.competitions.length === 0) {
                    content.innerHTML = '<div class="text-center"><p>Statistik visas n√§r t√§vlingsdata finns tillg√§nglig.</p></div>';
                    return;
                }

                // Ber√§kna grundl√§ggande statistik
                const totalCompetitions = this.competitions.length;
                const totalParticipants = this.participants.length;
                const years = this.competitions.map(c => c.year);
                const yearRange = {
                    start: Math.min(...years),
                    end: Math.max(...years)
                };

                // Vinnare statistik
                const winnerStats = {};
                this.competitions.forEach(comp => {
                    if (comp.winner) {
                        winnerStats[comp.winner] = (winnerStats[comp.winner] || 0) + 1;
                    }
                });

                const topWinners = Object.entries(winnerStats)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);

                let html = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-xl); margin-bottom: var(--spacing-2xl);">
                        <div style="background: var(--bg-primary); padding: var(--spacing-xl); border-radius: var(--radius-xl); text-align: center; box-shadow: var(--shadow-light); border: 1px solid var(--border-color);">
                            <h3 style="color: var(--text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-md); text-transform: uppercase;">T√§vlingar</h3>
                            <div style="font-size: var(--font-size-4xl); font-weight: 900; color: var(--primary-color); margin: var(--spacing-md) 0;">${totalCompetitions}</div>
                            <p style="color: var(--text-muted); font-size: var(--font-size-sm);">Genomf√∂rda</p>
                        </div>
                        
                        <div style="background: var(--bg-primary); padding: var(--spacing-xl); border-radius: var(--radius-xl); text-align: center; box-shadow: var(--shadow-light); border: 1px solid var(--border-color);">
                            <h3 style="color: var(--text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-md); text-transform: uppercase;">Deltagare</h3>
                            <div style="font-size: var(--font-size-4xl); font-weight: 900; color: var(--primary-color); margin: var(--spacing-md) 0;">${totalParticipants}</div>
                            <p style="color: var(--text-muted); font-size: var(--font-size-sm);">Totalt</p>
                        </div>
                        
                        <div style="background: var(--bg-primary); padding: var(--spacing-xl); border-radius: var(--radius-xl); text-align: center; box-shadow: var(--shadow-light); border: 1px solid var(--border-color);">
                            <h3 style="color: var(--text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-md); text-transform: uppercase;">Tidsspan</h3>
                            <div style="font-size: var(--font-size-4xl); font-weight: 900; color: var(--primary-color); margin: var(--spacing-md) 0;">${yearRange.end - yearRange.start + 1}</div>
                            <p style="color: var(--text-muted); font-size: var(--font-size-sm);">${yearRange.start}-${yearRange.end}</p>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-primary); padding: var(--spacing-xl); border-radius: var(--radius-xl); box-shadow: var(--shadow-light); border: 1px solid var(--border-color);">
                        <h3 style="color: var(--text-primary); font-size: var(--font-size-lg); margin-bottom: var(--spacing-lg); display: flex; align-items: center; gap: var(--spacing-sm);">üèÜ Flest Vinster</h3>
                        <div style="display: grid; gap: var(--spacing-md);">
                `;

                const medals = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'];
                topWinners.forEach(([winner, wins], index) => {
                    html += `
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-lg); background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-color);">
                            <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                <span style="font-size: var(--font-size-xl);">${medals[index] || 'üèÖ'}</span>
                                <span style="font-weight: 600; color: var(--text-primary); font-size: var(--font-size-lg);">${winner}</span>
                            </div>
                            <span style="font-weight: 700; color: var(--primary-color); font-size: var(--font-size-lg);">${wins} ${wins === 1 ? 'vinst' : 'vinster'}</span>
                        </div>
                    `;
                });

                html += '</div></div>';
                content.innerHTML = html;
            }

            renderSettings() {
                const content = document.getElementById('settings-content');
                
                const storageData = localStorage.getItem('pekkas-pokal-data');
                const storageSize = storageData ? storageData.length : 0;
                const formattedSize = this.formatBytes(storageSize);

                content.innerHTML = `
                    <div style="display: grid; gap: var(--spacing-2xl);">
                        <div style="background: var(--bg-primary); padding: var(--spacing-xl); border-radius: var(--radius-xl); box-shadow: var(--shadow-light); border: 1px solid var(--border-color);">
                            <h3 style="color: var(--text-primary); margin-bottom: var(--spacing-lg); display: flex; align-items: center; gap: var(--spacing-sm);">üíæ Datahantering</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                <button onclick="app.exportData()" class="btn primary">
                                    <span>üì¶</span> Exportera Data
                                </button>
                                <button onclick="app.clearData()" class="btn danger">
                                    <span>üóëÔ∏è</span> Rensa Data
                                </button>
                            </div>
                            <div style="padding: var(--spacing-lg); background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-color);">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--spacing-md); text-align: center;">
                                    <div>
                                        <div style="font-weight: 700; color: var(--primary-color);">${formattedSize}</div>
                                        <div style="font-size: var(--font-size-sm); color: var(--text-muted);">Lagrad data</div>
                                    </div>
                                    <div>
                                        <div style="font-weight: 700; color: var(--primary-color);">${this.competitions.length}</div>
                                        <div style="font-size: var(--font-size-sm); color: var(--text-muted);">T√§vlingar</div>
                                    </div>
                                    <div>
                                        <div style="font-weight: 700; color: var(--primary-color);">${this.participants.length}</div>
                                        <div style="font-size: var(--font-size-sm); color: var(--text-muted);">Deltagare</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--bg-primary); padding: var(--spacing-xl); border-radius: var(--radius-xl); box-shadow: var(--shadow-light); border: 1px solid var(--border-color); text-align: center;">
                            <h3 style="color: var(--text-primary); margin-bottom: var(--spacing-lg);">‚ÑπÔ∏è Om Appen</h3>
                            <p style="margin-bottom: var(--spacing-sm);"><strong>Pekkas Pokal</strong> v2.0</p>
                            <p style="margin-bottom: var(--spacing-sm);">Modern t√§vlingssp√•rning f√∂r v√§nner</p>
                            <p style="color: var(--text-muted);">Utvecklad med ‚ù§Ô∏è f√∂r fair play och roliga t√§vlingar</p>
                        </div>
                    </div>
                `;
            }

            switchTab(tabName) {
                // Uppdatera navigation
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');

                this.currentTab = tabName;
            }

            toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';

                document.documentElement.setAttribute('data-theme', newTheme);
                document.getElementById('theme-toggle').textContent = newTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            }

            showImportSection() {
                document.getElementById('csv-import-section').classList.remove('hidden');
            }

            hideImportSection() {
                document.getElementById('csv-import-section').classList.add('hidden');
            }

            exportData() {
                try {
                    const data = {
                        version: '2.0',
                        exportDate: new Date().toISOString(),
                        competitions: this.competitions,
                        participants: this.participants
                    };

                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `pekkas-pokal-backup-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();

                    URL.revokeObjectURL(url);
                    alert('Data exporterad framg√•ngsrikt!');
                } catch (error) {
                    console.error('Export misslyckades:', error);
                    alert('Fel vid export av data');
                }
            }

            clearData() {
                if (confirm('√Ñr du s√§ker p√• att du vill rensa all data? Detta kan inte √•ngras.')) {
                    localStorage.removeItem('pekkas-pokal-data');
                    window.location.reload();
                }
            }

            formatBytes(bytes, decimals = 2) {
                if (bytes === 0) return '0 Bytes';

                const k = 1024;
                const dm = decimals < 0 ? 0 : decimals;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];

                const i = Math.floor(Math.log(bytes) / Math.log(k));

                return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
            }
        }

        // STARTA APPLIKATIONEN
        let app;
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                app = new PekkasPokalkApp();
            });
        } else {
            app = new PekkasPokalkApp();
        }

        console.log('‚úÖ Pekkas Pokal redo!');
    </script>
</body>
</html>